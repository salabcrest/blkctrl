
 ********************************************************************************
 ****  <<<<<<<<<< 注意 >>>>>>>>>>  **********************************************
 **** このプログラムはあなたのディスクパーティションを破壊するかもしれません ****
 **** このマニュアルを丁寧に読んでから実行してください **************************
 ********************************************************************************

・説明ファイル(readme-j.txt)を丁寧に読んで実行してください．
・良く理解しないまま 実行すると，
　あなたの計算機のディスクパーティションを破損することになります．



このプログラムは，
「Ext2/3/4 の指定したブロックグループのブロックビットマップ(そのブロックグループ内の各ブロックが空きか使用中かを管理するビット群)の全ビットを1(使用中を意味する)に変更し，結果的にそのブロックグループの使用を(そのブロックグループ内にファイルデータが配置されることを)禁止するプログラム」です．

「全ビットを1に変更」する前のブロックビットマップの情報はバックアップとしてファイルに保存されますが，
そのバックアップをリストアする(再度適用し元に戻す)プログラムは現在は提供されておりません．



-- 実行に必要な環境
・ Ext2/3/4 のいずれかでフォーマットされたパーティション
・ gcc
・ ruby
・ テキストエディタ



-- 実行するためにユーザが指定する情報
実行するためには，ユーザは
(1) 使用を禁止したいブロックグループを含むパーティションの名前
(2) 使用を禁止したいブロックグループの番号
(3) 使用を禁止したいブロックグループのブロックビットマップのバックアップの保存先ディレクトリ
を指定する必要があります．

以下「使用手順」の例は「(1)が /dev/sdb1, (2)が 6，(3)が /tmp/」の例となっています．


-- 使用手順
- 1. パーティション名の指定
	swap_bitmap.c の4行目を編集します．
		もし /dev/sdb1 内のパーティションのあるブロックグループを使用禁止にしたいなら，
		以下の様に編集します．
			#define devfile "/dev/sdx1"
			↓
			#define devfile "/dev/sdb1"

	get_table_original.sh の2行目を編集します．
		もし /dev/sdb1 内のパーティションのあるブロックグループを使用禁止にしたいなら，
		以下の様に編集します．
			dumpe2fs /dev/sdx1 | ruby get_bitmap_table_original.rb > group_table.tbl;
			↓
			dumpe2fs /dev/sdb1 | ruby get_bitmap_table_original.rb > group_table.tbl;

- 2. ブロックビットマップのバックアックファイルを保存するディレクトリの指定
	swap_bitmap.c の5行目を編集します．
		もし "/tmp/" にバックアップファイルを保存したいなら，
		以下の様に編集します．
			#define BAKUPDIR "/root/dynamic_ctrl_mod/swaped"
			↓
			#define BAKUPDIR "/tmp"


- 3．対象パーティション(/dev/sdb)の全ブロックグループのブロックビットマップのブロックアドレスの取得
	sh get_table_original.sh
	を実行すると，
	テキストファイル group_table_original.tbl が得られ，
	そのファイル内には 下記の様に「ブロックグループ番号」と「そのブロックビットマップのブロックアドレス」が列挙されています．
	データのフォーマットは，1行につき「ブロックグループ番号」と「そのブロックビットマップのブロックアドレス」の組が1個で，
	両者は半角スペースで区切られています．

		例
			0 1537
			1 34306
			2 66050
			3 99844
			4 131588
			5 165382
			6 197126
			:
		この例は，
		ブロックグループ番号0 の ブロックビットマップのブロックアドレスは 1537 で，
		ブロックグループ番号1 の ブロックビットマップのブロックアドレスは 34306 であることを
		意味しています．

- 4. swap_bitmap のコンパイル
	gcc swap_bitmap.c -o swap_bitmap
	と実行します

- 5．./swap_bitmap の実行によるあるブロックグループの使用を禁止にする
	./swap_bitmap <第1引数> <第2引数>
	と実行します．
	第1引数に使用禁止にしたいブロックグループ番号を，
	第2引数にそのブロックグループのブロックビットマップのブロックアドレスを指定します．
	第2引数の「そのブロックグループのブロックビットマップのブロックアドレス」は，
	手順 3. で得られた group_table_original.tbl を見れば得られる．
		もし /dev/sdb1 の ブロックグループ 6 を 使用禁止にしたいなら，
			./swap_bitmap 6 197126
		と実行する．
	
	また，バックアップ用ディレクトリに指定した場所(例えば"/tmp")に，
	ブロックビットマップのバックアップファイル(例えば"bitmap_00006_197126.bin")が
	保存される．

